#!/bin/bash

my_dir="$(dirname "$(readlink -e "${BASH_SOURCE[0]}")")"

testno=0
failures=0

do1() {
    ((testno++))
    cat > cor.txt
    python "$my_dir"/showfloat.py "$@" &> got.txt
    if ! diff -u cor.txt got.txt > diff.txt; then
        if ((failures > 0)); then
            echo
        fi
        ((failures++))
        echo "=== Failed test $testno: showfloat $@" | sed -f color.sed
        sed -f color.sed diff.txt
    fi
    rm cor.txt got.txt diff.txt
}

tempdir="$(mktemp -d)"
pushd "$tempdir" > /dev/null

touch color.sed
# Only use color escapes if stdout is a tty.
if [ -t 1 ]; then
    # Note: which colors look good will depend on exactly how your terminal
    # displays them and what background color you use. These choices are what
    # happen to look good on my terminals. Since this is just the test script,
    # I don't provide a good way to configure it, aside from just hacking up
    # the tput calls manually.
    cat > color.sed <<END
# Failure header in bold red
/^=== /{
    s/^/$(tput setaf 1)$(tput bold)/
    s/$/$(tput sgr0)/
}
# Diff/hunk headers in green (disabled)
#/^\(---\|+++\|@@\) /{
#    s/^/$(tput setaf 2)/
#    s/$/$(tput sgr0)/
#}
# Don't treat diff header as deletion/insertion
/^\(---\|+++\)/!{
    # Deletions in yellow
    /^-/{
        s/^/$(tput setaf 3)/
        s/$/$(tput sgr0)/
    }
    # Insertions in cyan
    /^+/{
        s/^/$(tput setaf 6)/
        s/$/$(tput sgr0)/
    }
}
END
fi

finish() {
    rm color.sed
    popd > /dev/null
    rmdir "$tempdir"

    if ((failures > 0)); then
        echo
        echo "Failed $failures of $testno tests"
    else
        echo "Passed all $testno tests"
    fi
}



###############################################################################

# These tests were haphazardly thrown together by just taking some examples I'd
# tried and testing them against whatever output we already gave. Mostly they
# just verify that the output doesn't change unexpectedly.

do1 -0x1.55554p-126 <<END
### INPUT HEX: -0x1.55554p-126
Dec (approx): -1.56732431e-38
Hex (%a):     -0x1.55554p-126
int10 * ULP:  -11184800 * 2**-149
fpclassify:   FP_NORMAL
Bits (hex):   0x80aaaaa0
Bits (bin):   1 00000001 01010101010101010100000
END

do1 --exact -0x1.55554p-126 <<END
### INPUT HEX: -0x1.55554p-126
Dec (exact):  -1.5673243063780213974867730643181053945143473767500453603948457341650535301624813655507750809192657470703125e-38
Hex (%a):     -0x1.55554p-126
int10 * ULP:  -11184800 * 2**-149
fpclassify:   FP_NORMAL
Bits (hex):   0x80aaaaa0
Bits (bin):   1 00000001 01010101010101010100000
END



# Remaining tests were written intentionally.



###############################################################################
# Basic floating-point categories / edge-cases, single precision

do1 inf <<END
### INPUT DECIMAL: inf
Dec (approx): inf
Hex (%a):     inf
fpclassify:   FP_INFINITE
Bits (hex):   0x7f800000
Bits (bin):   0 11111111 00000000000000000000000
END

do1 -inf <<END
### INPUT DECIMAL: -inf
Dec (approx): -inf
Hex (%a):     -inf
fpclassify:   FP_INFINITE
Bits (hex):   0xff800000
Bits (bin):   1 11111111 00000000000000000000000
END

do1 nan <<END
### INPUT DECIMAL: nan
Dec (approx): nan
Hex (%a):     nan
fpclassify:   FP_NAN
Example bits
       (hex): 0x7fc00000
       (bin): 0 11111111 10000000000000000000000
END

do1 -nan <<END
### INPUT DECIMAL: -nan
Dec (approx): -nan
Hex (%a):     -nan
fpclassify:   FP_NAN
Example bits
       (hex): 0xffc00000
       (bin): 1 11111111 10000000000000000000000
END

do1 0 <<END
### INPUT DECIMAL: 0
Dec (approx): 0
Hex (%a):     0x0p+0
int10 * ULP:  0 * 2**-149
fpclassify:   FP_ZERO
Bits (hex):   0x00000000
Bits (bin):   0 00000000 00000000000000000000000
END

do1 -0 <<END
### INPUT DECIMAL: -0
Dec (approx): -0
Hex (%a):     -0x0p+0
int10 * ULP:  -0 * 2**-149
fpclassify:   FP_ZERO
Bits (hex):   0x80000000
Bits (bin):   1 00000000 00000000000000000000000
END

do1 0x1p-149 <<END
### INPUT HEX: 0x1p-149
Dec (approx): 1.40129846e-45
Hex (%a):     0x0.000002p-126
int10 * ULP:  1 * 2**-149
fpclassify:   FP_SUBNORMAL
Bits (hex):   0x00000001
Bits (bin):   0 00000000 00000000000000000000001
END

do1 -5e-42 <<END
### INPUT DECIMAL: -5e-42
Dec (approx): -4.99983292e-42
Hex (%a):     -0x0.001bep-126
int10 * ULP:  -3568 * 2**-149
fpclassify:   FP_SUBNORMAL
Bits (hex):   0x80000df0
Bits (bin):   1 00000000 00000000000110111110000
END

do1 0x0.fffffep-126 <<END
### INPUT HEX: 0x0.fffffep-126
Dec (approx): 1.17549421e-38
Hex (%a):     0x0.fffffep-126
int10 * ULP:  8388607 * 2**-149
fpclassify:   FP_SUBNORMAL
Bits (hex):   0x007fffff
Bits (bin):   0 00000000 11111111111111111111111
END

do1 -0x1p-126 <<END
### INPUT HEX: -0x1p-126
Dec (approx): -1.17549435e-38
Hex (%a):     -0x1p-126
int10 * ULP:  -8388608 * 2**-149
fpclassify:   FP_NORMAL
Bits (hex):   0x80800000
Bits (bin):   1 00000001 00000000000000000000000
END

do1 4194303.75 <<END
### INPUT DECIMAL: 4194303.75
Dec (approx): 4194303.75
Hex (%a):     0x1.fffffep+21
int10 * ULP:  16777215 * 2**-2
fpclassify:   FP_NORMAL
Bits (hex):   0x4a7fffff
Bits (bin):   0 10010100 11111111111111111111111
END

do1 -4194304 <<END
### INPUT DECIMAL: -4194304
Dec (approx): -4194304
Hex (%a):     -0x1p+22
int10 * ULP:  -8388608 * 2**-1
fpclassify:   FP_NORMAL
Bits (hex):   0xca800000
Bits (bin):   1 10010101 00000000000000000000000
END

do1 1.2345e+10 <<END
### INPUT DECIMAL: 1.2345e+10
Dec (approx): 1.23449999e+10
Hex (%a):     0x1.6fe8ep+33
int10 * ULP:  12055664 * 2**10
fpclassify:   FP_NORMAL
Bits (hex):   0x5037f470
Bits (bin):   0 10100000 01101111111010001110000
END

do1 -0x1.fffffep+127 <<END
### INPUT HEX: -0x1.fffffep+127
Dec (approx): -3.40282347e+38
Hex (%a):     -0x1.fffffep+127
int10 * ULP:  -16777215 * 2**104
fpclassify:   FP_NORMAL
Bits (hex):   0xff7fffff
Bits (bin):   1 11111110 11111111111111111111111
END



###############################################################################
# Input from bits (mostly same cases from above)

do1 --bits 0 <<END
### INPUT BITS: 0
Dec (approx): 0
Hex (%a):     0x0p+0
int10 * ULP:  0 * 2**-149
fpclassify:   FP_ZERO
Bits (hex):   0x00000000
Bits (bin):   0 00000000 00000000000000000000000
END

do1 --bits 0x80000000 <<END
### INPUT BITS: 0x80000000
Dec (approx): -0
Hex (%a):     -0x0p+0
int10 * ULP:  -0 * 2**-149
fpclassify:   FP_ZERO
Bits (hex):   0x80000000
Bits (bin):   1 00000000 00000000000000000000000
END

do1 --bits 1 <<END
### INPUT BITS: 1
Dec (approx): 1.40129846e-45
Hex (%a):     0x0.000002p-126
int10 * ULP:  1 * 2**-149
fpclassify:   FP_SUBNORMAL
Bits (hex):   0x00000001
Bits (bin):   0 00000000 00000000000000000000001
END

do1 --bits 0x7fffff <<END
### INPUT BITS: 0x7fffff
Dec (approx): 1.17549421e-38
Hex (%a):     0x0.fffffep-126
int10 * ULP:  8388607 * 2**-149
fpclassify:   FP_SUBNORMAL
Bits (hex):   0x007fffff
Bits (bin):   0 00000000 11111111111111111111111
END

do1 --bits 0x80800000 <<END
### INPUT BITS: 0x80800000
Dec (approx): -1.17549435e-38
Hex (%a):     -0x1p-126
int10 * ULP:  -8388608 * 2**-149
fpclassify:   FP_NORMAL
Bits (hex):   0x80800000
Bits (bin):   1 00000001 00000000000000000000000
END

# Just some arbitrary hex value, not a duplicate with the previous group of
# cases
do1 --bits 0x12345678 <<END
### INPUT BITS: 0x12345678
Dec (approx): 5.69045661e-28
Hex (%a):     0x1.68acfp-91
int10 * ULP:  11818616 * 2**-114
fpclassify:   FP_NORMAL
Bits (hex):   0x12345678
Bits (bin):   0 00100100 01101000101011001111000
END

do1 --bits 0x4a7fffff <<END
### INPUT BITS: 0x4a7fffff
Dec (approx): 4194303.75
Hex (%a):     0x1.fffffep+21
int10 * ULP:  16777215 * 2**-2
fpclassify:   FP_NORMAL
Bits (hex):   0x4a7fffff
Bits (bin):   0 10010100 11111111111111111111111
END

do1 --bits 0xca800000 <<END
### INPUT BITS: 0xca800000
Dec (approx): -4194304
Hex (%a):     -0x1p+22
int10 * ULP:  -8388608 * 2**-1
fpclassify:   FP_NORMAL
Bits (hex):   0xca800000
Bits (bin):   1 10010101 00000000000000000000000
END

do1 --bits 0xff7fffff <<END
### INPUT BITS: 0xff7fffff
Dec (approx): -3.40282347e+38
Hex (%a):     -0x1.fffffep+127
int10 * ULP:  -16777215 * 2**104
fpclassify:   FP_NORMAL
Bits (hex):   0xff7fffff
Bits (bin):   1 11111110 11111111111111111111111
END

do1 --bits 0x7f800000 <<END
### INPUT BITS: 0x7f800000
Dec (approx): inf
Hex (%a):     inf
fpclassify:   FP_INFINITE
Bits (hex):   0x7f800000
Bits (bin):   0 11111111 00000000000000000000000
END

do1 --bits 0xff800000 <<END
### INPUT BITS: 0xff800000
Dec (approx): -inf
Hex (%a):     -inf
fpclassify:   FP_INFINITE
Bits (hex):   0xff800000
Bits (bin):   1 11111111 00000000000000000000000
END

# The canonical NaN (per the convention this script uses, anyway).
# Since it was specified by bits, it should NOT show as "example bits".
do1 --bits 0x7fc00000 <<END
### INPUT BITS: 0x7fc00000
Dec (approx): nan
Hex (%a):     nan
fpclassify:   FP_NAN
Bits (hex):   0x7fc00000
Bits (bin):   0 11111111 10000000000000000000000
END

# Non-canonical NaNs
do1 --bits 0x7f801230 <<END
### INPUT BITS: 0x7f801230
Dec (approx): nan
Hex (%a):     nan
fpclassify:   FP_NAN
Bits (hex):   0x7f801230
Bits (bin):   0 11111111 00000000001001000110000
END

do1 --bits 0xff800001 <<END
### INPUT BITS: 0xff800001
Dec (approx): -nan
Hex (%a):     -nan
fpclassify:   FP_NAN
Bits (hex):   0xff800001
Bits (bin):   1 11111111 00000000000000000000001
END



###############################################################################
# Weird Intel80-specific cases where leading mantissa bit has wrong value

do1 --intel80 --bits 0x7fff4000000000000000 <<END
### INPUT BITS: 0x7fff4000000000000000
Dec (approx): nan
Hex (%a):     nan
fpclassify:   Pseudo-NaN
Bits (hex):   0x7fff4000000000000000
Bits (bin):   0 111111111111111 0100000000000000000000000000000000000000000000000000000000000000
END

do1 --intel80 --bits 0x7fff0000000000000000 <<END
### INPUT BITS: 0x7fff0000000000000000
Dec (approx): inf
Hex (%a):     inf
fpclassify:   Pseudo-infinity
Bits (hex):   0x7fff0000000000000000
Bits (bin):   0 111111111111111 0000000000000000000000000000000000000000000000000000000000000000
END

# Clear the leading bit from 1.5 and we get 0.5
do1 --intel80 --bits 0x3fff4000000000000000 <<END
### INPUT BITS: 0x3fff4000000000000000
Dec (approx): 0.5
Hex (%a):     0x0.8p+0
int10 * ULP:  4611686018427387904 * 2**-63
fpclassify:   Unnormal
Bits (hex):   0x3fff4000000000000000
Bits (bin):   0 011111111111111 0100000000000000000000000000000000000000000000000000000000000000
END

# Clear the leading bit from 1.0 and we get 0.0, which is not any kind of
# subnormal even though it has value 0. Just an unnormal with a zero mantissa.
do1 --intel80 --bits 0x3fff0000000000000000 <<END
### INPUT BITS: 0x3fff0000000000000000
Dec (approx): 0
Hex (%a):     0x0p+0
int10 * ULP:  0 * 2**-63
fpclassify:   Unnormal
Bits (hex):   0x3fff0000000000000000
Bits (bin):   0 011111111111111 0000000000000000000000000000000000000000000000000000000000000000
END

# Pseudo-denormal where we set the leading bit on something already nonzero
do1 --intel80 --bits 0x0000c000000000000000 <<END
### INPUT BITS: 0x0000c000000000000000
Dec (approx): 5.04315471466814025939e-4932
Hex (%a):     0x1.8p-16382
int10 * ULP:  13835058055282163712 * 2**-16445
fpclassify:   Pseudo-denormal
Bits (hex):   0x0000c000000000000000
Bits (bin):   0 000000000000000 1100000000000000000000000000000000000000000000000000000000000000
END

# Pseudo-denormal where we set the leading bit on 0.0.
do1 --intel80 --bits 0x00008000000000000000 <<END
### INPUT BITS: 0x00008000000000000000
Dec (approx): 3.36210314311209350626e-4932
Hex (%a):     0x1p-16382
int10 * ULP:  9223372036854775808 * 2**-16445
fpclassify:   Pseudo-denormal
Bits (hex):   0x00008000000000000000
Bits (bin):   0 000000000000000 1000000000000000000000000000000000000000000000000000000000000000
END



###############################################################################
# Error cases (and some barely-not-error boundary cases)

do1 junk <<END
Error: failed to parse value 'junk'
END

do1 --exact 1.234junk <<END
Error: failed to parse value '1.234junk'
END

do1 --bits blargh <<END
Error: illegal bits 'blargh', must be nonnegative integer
END

do1 --bits 3.5 <<END
Error: illegal bits '3.5', must be nonnegative integer
END

do1 --bits -0xaaaaaaaa <<END
Error: illegal bits '-0xaaaaaaaa', must be nonnegative integer
END

do1 --bits -0xaaaaaaaa <<END
Error: illegal bits '-0xaaaaaaaa', must be nonnegative integer
END

# Bits just barely too large for binary32
do1 --bits 0x100000000 <<END
Error: bits '0x100000000' too large, 33 bits long but binary32 format only has 32 bits
END

# Bits just barely not too large
do1 --bits 0xffffffff <<END
### INPUT BITS: 0xffffffff
Dec (approx): -nan
Hex (%a):     -nan
fpclassify:   FP_NAN
Bits (hex):   0xffffffff
Bits (bin):   1 11111111 11111111111111111111111
END

# Larger values are fine in binary64...
do1 --double --bits 0x4000000000000000 <<END
### INPUT BITS: 0x4000000000000000
Dec (approx): 2
Hex (%a):     0x1p+1
int10 * ULP:  4503599627370496 * 2**-51
fpclassify:   FP_NORMAL
Bits (hex):   0x4000000000000000
Bits (bin):   0 10000000000 0000000000000000000000000000000000000000000000000000
END

# ...to a point
do1 --double --bits 0x10000000000000000 <<END
Error: bits '0x10000000000000000' too large, 65 bits long but binary64 format only has 64 bits
END


###############################################################################

# TODO other categories:
#   - Types: double precision, half, Intel80
#       - Probably start with some basic sanity checks in these
#       - Don't need +/- inf, +/- nan, +/- 0 in every type. At most one sign of
#         each in other types.
#       - Note we have tricky decimal cases below which include max norm, min
#         subnorm, and a small normal.
#       - Probably a good set of inputs for a new type:
#           - inf (by value and by bits)
#           - nan (by value and by bits)
#           - A moderate normal
#           - A normal whose hex digits run all the way to the end of the
#             mantissa? (e.g. .aaaa... with a 0xd or sthg at the end)
#               - TODO also for float
#               - Something negative, could be one of the normals
#               - One of the above by bits as well (maybe the negative one?)
#           - TYP_MIN and nextDown(TYP_MIN)?
#   - Semi-bad inputs (especially unrepresentable hex, but also over/underflow
#     and decimal rounding edge cases)
#       - Renormalizing hex, and generally misnormalized cases



###############################################################################
# Some cases with pathologically long representations. In each format:
#   - Max value
#   - nextDown(2 * min normal value)
#       - I believe this is the worst case for length of decimal
#         representation. It is the largest value with an ulp of min-subnormal.
#   - Min subnormal value
# The expected strings come from WolframAlpha. Note that you can enter things
# like "2**-16445 to 16000 digits" to get around the usual limit on how many
# times it'll let you click "more digits" (though there does still seem to be a
# max before it gives up).
#
# These are here at the very end because they're so long you can't really find
# anything after them in the test file.

# TODO half precision

# Float

do1 --exact 0x1.fffffep+127 <<END
### INPUT HEX: 0x1.fffffep+127
Dec (exact):  340282346638528859811704183484516925440
Hex (%a):     0x1.fffffep+127
int10 * ULP:  16777215 * 2**104
fpclassify:   FP_NORMAL
Bits (hex):   0x7f7fffff
Bits (bin):   0 11111110 11111111111111111111111
END

do1 --exact 0x1.fffffep-126 <<END
### INPUT HEX: 0x1.fffffep-126
Dec (exact):  2.350988561514728583455765982071533026645717985517980855365926236850006129930346077117064851336181163787841796875e-38
Hex (%a):     0x1.fffffep-126
int10 * ULP:  16777215 * 2**-149
fpclassify:   FP_NORMAL
Bits (hex):   0x00ffffff
Bits (bin):   0 00000001 11111111111111111111111
END

do1 --exact --bits 1 <<END
### INPUT BITS: 1
Dec (exact):  1.40129846432481707092372958328991613128026194187651577175706828388979108268586060148663818836212158203125e-45
Hex (%a):     0x0.000002p-126
int10 * ULP:  1 * 2**-149
fpclassify:   FP_SUBNORMAL
Bits (hex):   0x00000001
Bits (bin):   0 00000000 00000000000000000000001
END

do1 --exact --double 0x1.fffffffffffffp+1023 <<END
### INPUT HEX: 0x1.fffffffffffffp+1023
Dec (exact):  179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368
Hex (%a):     0x1.fffffffffffffp+1023
int10 * ULP:  9007199254740991 * 2**971
fpclassify:   FP_NORMAL
Bits (hex):   0x7fefffffffffffff
Bits (bin):   0 11111111110 1111111111111111111111111111111111111111111111111111
END

do1 --exact --double 0x1.fffffffffffffp-1022 <<END
### INPUT HEX: 0x1.fffffffffffffp-1022
Dec (exact):  4.4501477170144022721148195934182639518696390927032912960468522194496444440421538910330590478162701758282983178260792422137401728773891892910553144148156412434867599762821265346585071045737627442980259622449029037796981144446145705102663115100318287949527959668236039986479250965780342141637013812613333119898765515451440315261253813266652951306000184917766328660755595837392240989947807556594098101021612198814605258742579179000071675999344145086087205681577915435923018910334964869420614052182892431445797605163650903606514140377217442262561590244668525767372446430075513332450079650686719491377688478005309963967709758965844137894433796621993967316936280457084866613206797017728916080020698679408551343728867675409720757232455434770912461317493580281734466552734375e-308
Hex (%a):     0x1.fffffffffffffp-1022
int10 * ULP:  9007199254740991 * 2**-1074
fpclassify:   FP_NORMAL
Bits (hex):   0x001fffffffffffff
Bits (bin):   0 00000000001 1111111111111111111111111111111111111111111111111111
END

do1 --exact --double --bits 1 <<END
### INPUT BITS: 1
Dec (exact):  4.940656458412465441765687928682213723650598026143247644255856825006755072702087518652998363616359923797965646954457177309266567103559397963987747960107818781263007131903114045278458171678489821036887186360569987307230500063874091535649843873124733972731696151400317153853980741262385655911710266585566867681870395603106249319452715914924553293054565444011274801297099995419319894090804165633245247571478690147267801593552386115501348035264934720193790268107107491703332226844753335720832431936092382893458368060106011506169809753078342277318329247904982524730776375927247874656084778203734469699533647017972677717585125660551199131504891101451037862738167250955837389733598993664809941164205702637090279242767544565229087538682506419718265533447265625e-324
Hex (%a):     0x0.0000000000001p-1022
int10 * ULP:  1 * 2**-1074
fpclassify:   FP_SUBNORMAL
Bits (hex):   0x0000000000000001
Bits (bin):   0 00000000000 0000000000000000000000000000000000000000000000000001
END

do1 --exact --intel80 0x1.fffffffffffffffep+16383 <<END
### INPUT HEX: 0x1.fffffffffffffffep+16383
Dec (exact):  1189731495357231765021263853030970205169063322294624200440323733891737005522970722616410290336528882853545697807495577314427443153670288434198125573853743678673593200706973263201915918282961524365529510646791086614311790632169778838896134786560600399148753433211454911160088679845154866512852340149773037600009125479393966223151383622417838542743917838138717805889487540575168226347659235576974805113725649020884855222494791399377585026011773549180099796226026859508558883608159846900235645132346594476384939859276456284579661772930407806609229102715046085388087959327781622986827547830768080040150694942303411728957777100335714010559775242124057347007386251660110828379119623008469277200965153500208474470792443848545912886723000619085126472111951361467527633519562927597957250278002980795904193139603021470997035276467445530922022679656280991498232083329641241038509239184734786121921697210543484287048353408113042573002216421348917347174234800714880751002064390517234247656004721768096486107994943415703476320643558624207443504424380566136017608837478165389027809576975977286860071487028287955567141404632615832623602762896316173978484254486860609948270867968048078702511858930838546584223040908805996294594586201903766048446790926002225410530775901065760671347200125846406957030257138960983757998926954553052368560758683179223113639519468850880771872104705203957587480013143131444254943919940175753169339392366881856189129931729104252921236835159922322050998001677102784035360140829296398115122877768135706045789343535451696539561254048846447169786893211671087229088082778350518228857646062218739702851655083720992349483334435228984751232753726636066213902281264706234075352071724058665079518217303463782631353393706774901950197841690441824738063162828586857741432581165364040218402724913393320949219498422442730427019873044536620350262386957804682003601447291997123095530057206141866974852846856186514832715974481203121946751686379343096189615107330065552421485195201762858595091051839472502863871632494167613804996319791441870254302706758495192008837915169401581740046711477877201459644461175204059453504764721807975761111720846273639279600339670470037613374509553184150073796412605047923251661354841291884211340823015473304754067072818763503617332908005951896325207071673904547777129682265206225651439919376804400292380903112437912614776255964694221981375146967079446870358004392507659451618379811859392049544036114915310782251072691486979809240946772142727012404377187409216756613634938900451232351668146089322400697993176017805338191849981933008410985993938760292601390911414526003720284872132411955424282101831204216104467404621635336900583664606591156298764745525068145003932941404131495400677602951005962253022823003631473824681059648442441324864573137437595096416168048024129351876204668135636877532814675538798871771836512893947195335061885003267607354388673368002074387849657014576090349857571243045102038730494854256702479339322809110526041538528994849203991091946129912491633289917998094380337879522093131466946149705939664152375949285890960489916121944989986384837022486672249148924678410206183364627416969576307632480235587975245253737035433882960862753427740016333434055083537048507374544819754722228975281083020898682633020285259923084168054539687911418297629988964576482765287504562854924265165217750799516259669229114977788962356670956627138482018191348321687995863652637620978285070099337294396784639879024914514222742527006363942327998483976739987154418554201562244154926653014515504685489258620276085761837129763358761215382565129633538141663949516556000264159186554850057052611431952919918807954522394649627635630178580896692226406235382898535867595990647008385687123810329591926494846250768992258419305480763620215089022149220528069842018350840586938493815498909445461977893029113576516775406232278298314033473276603952231603422824717528181818844304880921321933550869873395861276073670866652375555675803171490108477320096424318780070008797346032906278943553743564448851907191616455141155761939399690767415156402826543664026760095087523945507341556135867933066031744720924446513532366647649735400851967040771103640538150073486891798364049570606189535005089840913826869535090066783324472578712196604415284924840041850932811908963634175739897166596000759487800619164094854338758520657116541072260996288150123144377944008749301944744330784388995701842710004808305012177123560622895076269042856800047718893158089358515593863176652948089031267747029662545110861548958395087796755464137944895960527975209874813839762578592105756284401759349324162148339565350189196811389091843795734703269406342890087805846940352453479398080674273236297887100867175802531561302356064878709259865288416350972529537091114317204887747405539054009425375424119317944175137064689643861517718849867010341532542385911089624710885385808688837777258648564145934262121086647588489260031762345960769508849149662444156604419552086811989770240
Hex (%a):     0x1.fffffffffffffffep+16383
int10 * ULP:  18446744073709551615 * 2**16320
fpclassify:   FP_NORMAL
Bits (hex):   0x7ffeffffffffffffffff
Bits (bin):   0 111111111111110 1111111111111111111111111111111111111111111111111111111111111111
END

do1 --exact --intel80 0x1.fffffffffffffffep-16382 <<END
### INPUT HEX: 0x1.fffffffffffffffep-16382
Dec (exact):  6.72420628622418701216083568145525774494331809633100049857774937804812906440935988538334824386677267204404774247506422593445548820873500317129828982711906024133610197541101627188940672801968869676824384701915629899429215268683860438982617221486458696576796409529842287834629644216707498058687848735159553783461246933552067183002893342938420803568105077310852283796672709150115749768746108720430701996971578046145150465652698293359552842354748661615072272505462733527453704558716602379736774934263645583870482630862482277568696432387873157508589824917935459011969004884321899767077095288450668477697220125638517814531242820123526046781040722946928673980367976778672938999248467685662841372953673374952536269361731086541857979862395465168536246781820334856894128922939914752213290120057853741727395288421687998823402376589265730643226612149390585164336835557543051551461375719495132926304810341995230216215806673174132632284758038490900565919320599160416831887030383364004208911470266863593466380337286759745829105137691045498001744571857507679258654559232332994412224723100964676284885321420922599670405321854921342129871433525027673220151245687681874140804759457159192153056507736091327176491132070289540273523037878546038741875187950422298768669195590751887269745140991622214848920842319562938328388097000375581205887522806004115984946383479009555106270968393983178717835751725292634578384468247250609951892826622105882535227277831927778459441639889039543749841157123748092768423119459818463957777158666158166800059098242762037586606204171765474421358216444692278893120252186058893968269225271818818791708286741488638492114707980231887468531559064188568025801922417724098702210627403182720981946654196604756511353012324311674321623453992277292098213790859915015397481925095337954964588440866866637024834365974719572679222567849534446651601453641954960797575565234055834090664161799542590268035863366151342686546506381726716241945581294703316801728562019800437999292057100416480555081451620203617860911380887169350267176086925527843517374433841772832837674671951574602036208410810599311290584245980175944615011300226110063730938675432925298584011580956725785366301953730348193286018697542804738195353849093254569947532246088161420934936556211473267049431054688544633072012087891329323238914015892993436794875674631781896283807427596068628928939683718715305291840890504960223854126161204500534191807791498029756953971506894357053648364674829468948409476378511226364466635318054860411387363500727784265254472491491349997344903753781788428538154054862189201808211600669920401911464499881645867562350388902788736621602451322058856085748068974184765908124709998552864435650977410830649475044813216765100142689176622257964898595266714604363481927666898155788973921117241664590788762457266527673505515101282561526229476022243921392339137333707336233749803582475756801632789926510644509901032168491463057895950806827611044813560877242049220953725698380012381637386545212712160362705797477538146707165574822371407475415551608858347606847961036376618772881648605128265101546417615260033837693792915933871294165240872146217010677568243269841568538667745937145949453856140386880976481290193456944421715562276387784152031536722122814819411708292220516802121618079556399310718743033748466485794334229985738574939225411144253437350195870685819492070426512633481997130790157879026078547395768290552530140183984734070508500352696935135735050623548972149699239571995631772072359682959976515115407796422517688395605123291604530192327071412084281991297928626486762018776125195071832981356264632218438165079836260299970519701718362435419574520581201424357396015877216398206228211740853263291609257223284887582405344561965072442073991783146465962495685925539523771142074485729896053853410723755361682771679792073543172086204050530774925559439163096366351668706955531968779942606965029064821319139243021514671950518453815051385439293545617374819018983729996957082443783159306977062227240550213062132102655721534348267953136898668455243225316014004511054838061168634544740361982558972798972527424787939473342059032022479520468256486365423745468728045420816754728052428511033704072284104735195873185903940701988338732490857911262236822730550331622078122801897839016044296380450218804712290878687138272864228351932398000020251485886789861367692464577116518495019657302604532325555989320770407188097499350355960603389456459639968591369369509554746775753479480181122269843278132495587205732898890641789680440862110977471042621663462917966888933762063037536948056373257129060875471222524229299527734845158045361097821400765712991260428345059376250514546391131898479154803691351597520842111206746368931828248960672718697222855072299926445990585564052808193080597297865803698149815822325080527366382069690509515457526232881535254790957741326451599464206854318823046950677829312540746633093065966230957495298402770611396732930354456515641975893513951186414736176613352717056311952614503061979669396446977059113188163796202194673413272721434629514608552036732131982429738321726769193978000708105270261443536246728292637823262051550061791032714530417232038740987610402661237246385356059892234600426056529405219809769937223648856068175171338421042119082751524342758297275171914903280895454374902248833317161089275546790441038338479582309499400448667950918179970338142666657699219889793034048154501298667740757439645598915815681030458231102334468909063744599625743269397977584713608303980224859373066829928663593069643383360686386419983202938221072269703193804708709935847936960646976652752170013815788542636854358911201041735404311164204089987101923961933667756110673387387710060457460572454853775649424904680798551409953604939274637546410382956817166636656661855110828944869133491291724027882032486382650924819822527004063682992376483330423813477499830625646186936005189860719453854015766574912541585514930082594225738707322371165681244323276584144584472756407297498277998052244071432993624793600585440537531407642770400563915820166559174853817634873632848942053095463924088879960865157422570000909858655925900340456006349985460922225502760264740230468589719039008626334081909794725480146980819683744420856212603257553131062059593592201566451159112516021299473813485387819379588905370764682200103267086009183815960227266491317057530751645405659224221814491394350098659757535351402576144706678105746242953181132577502443501313091254148042724824856280539489058308371678783696036888422636240212286546035523233764696227472291489614014105398292951785835129215279387462709536074355187035701321370958598756031943364571842612854594156143837400996941461594669354846117010903930746412522799237413540396705291147433753156590620918407842694642784401955483262496617171397239126555594766391759147911509059331560582995078294653335102364109998165078718619318623006914656464443660860709340139079888540281838705940406412860639136173408897230829044537200826842178584811890149893227612296543851116908807017579677909374360876136584615806334703656159044025453796497534120236134201677372568138708539705268180287133400036351264046595985149483396749894091721577334660429274521003827542722175226600828708302401832652712531977987917254486877456440496027937200496734248236450386540404340900592836149627472084557929183556162719317331455344781713656698706192864786420725878071031399602374664659437700025196894792298729931686634573260896690556831420778196495155690153475094227889372545515190054197572042609487807954949246883980141724857899601181790468142485452441661622776335482303267937415887354206836195369358580541924677206024834717179837890158625707446979544869860455052068488755552422731768008146014494363960594229904970617014856190307838101087243234375808182356935792011590110090850158467103480662709204817059750985352669430774935878860366622201451439903888140510125817722328193980620692742756210264045358124041627987366575170846404501227875377546845355760612264136926372795763049089681427275156382507776525350325190745468602260039694560280012997930421077810878363836559026609060649284491705826485488177046332501407891364465878848347276650118547551760146947751618609546021552623239999113889974014394581538238322952869198936588327499741545741272167418110953409633966809449088063072911436405795624708940631620080245187237983751842626985523157225810154515481921900996687354094960110891974502839324232877774529295796792552726967827354359645400341358133839799333537375104245705349091016417985024741737591217196924122649314864419456740038174554592917551876558967905908912855011904679438899993097197573142505838697882163648619295722113165499455251840763806638473174415614243501110432144422553097098470035188039058712059116290373127854515935174977954060864333562161143137196843929301529040112687894782216320409146605976145547593414830196312663585723367581709263287861388619818689596937916047473468751973207304735533352261696746808239983264611425139974020400701925611837619837360286850025168196892384977088271060050069631486994951501419874391494488475051514202259574243333107855536510117622733832528194092463419388902918455545786660132444637788616709587097888815710431395008342842439396284256696981771494785636888127162639330805148621070792960048215347661190418534707253908566146385299175141929200030262543171324462718026031035456458341877135231401651087530784627138450534876634252001554774311888781830553879857943274234886541979852799122879479501052899680185960116334243364634047957602546057297086555024565951870068157905390628980405978980965029861889806049411233667033396601910218233169584622971868302736673130966907946520905286723222918621665624175328264769612477795470359397742640078282312398532399680927594640544619392227095301141163506387095156130288276880536461330820479774643150263510958320451478756512858924320815434214673496888912926164395094246739138977171748835487828425817506458545200813017733476423979737846788046143508762588498878440456308209035361958818026398258303171412518977792559117788623860657721172102632783141142981998823155440531726650878207637478116983220666484783560887702472799258016454110152957740003127145551916206123627372103155165403194760212769392473701412475193263549270488880789785288017751860281559236924773730320491663214248109124014417087916481956405224027444091154240193154908672002175949940211452066022955514600405253557898150763098395043819170845138921953829526545854398725525544425555499320173821868935102520523827855357748975331172938450070205661705191155111681736285308274371586631795854059826388593592872623221858498615930251676579758130125680812441580822656761158639566476364138454857695840759842768926156707945446684441581415342978451605498049230353166552810107196011794932238607076724362894864268051466584915805299667764636942446351857161365809374766273252019910775648346601176044149805909867139354948237774450783472794054360145922926304062954773064973754451743319399905705374889080649092075479208937282921902865327356111495629372924318051067643656740202072186518013532188133341472832245095039207042248364854021414495790361715084760596416456300620031516254587305978176412939871019839406564591032146992230748209249128644667183450334999129052584601388306281206228700722558642918219260336426516638758923126803166141947826548191363282743324802476226791120864068908601830472176213267832321679407238974880747609299324885344601113142787423076677752064711494707304875823796425637742328039316762620670499392819011037613696427995377777959649517240779096434279790077086987324903967387099466054494724005503696051544437750635552220046520233154296875e-4932
Hex (%a):     0x1.fffffffffffffffep-16382
int10 * ULP:  18446744073709551615 * 2**-16445
fpclassify:   FP_NORMAL
Bits (hex):   0x0001ffffffffffffffff
Bits (bin):   0 000000000000001 1111111111111111111111111111111111111111111111111111111111111111
END

do1 --exact --intel80 --bits 1 <<END
### INPUT BITS: 1
Dec (exact):  3.6451995318824746025284059336194198163990508156935633437209804870283716886333977368095607086258272051972473473472035311019669856326220321699735080755898090054838225811779316785692252638056335597566215625659834107289403197935535272685912407999541728110155185383830460547687154224492953058597182682142626220675323554608440680792597537396882263389719028133546642119572938120002167626722920322774336390308456055297955188552992122553211711634876291384629300355138527501603132845785873465668580833490531237051939887039833085878399463225014686024594663765868704564236347102423971946588603575680671344779827642197362928177512955605368457612678466479085174632509237360395127227814159533660963994444034021170534884480219777636044379086876232490341169092945505322835546042550164710485109901552496948203761750727745215979248292641646728293792248343785221488475244616533404531408985349389010799994660849957929408670822251678980926263322841336335372303657106066727110161016969869085455268160934467855758235452864566704649092870630625875619302191928395746860797324007419326707925865842479032526017145025116520187337055564776698564030616718609883010220890087524042382938121214157585271795472816282327108859944585747150338528775954260248007917199819553441519165990035038288222003556659679587710909376884092310507637448820944563204842727161227981498363616605895952090835768872542325329552297498926405507629594382412784961938193820775459054611725479613404698176911656760942613207257273126074829376531404216196861030595291994214319374495660993373960630752183022438454753416779724620381266269034081670865175453863821550089560659554103929149526239278808471595331845354866664804805634075314283853293005224776842170509512647474546357548662147849415423151110386306843914252124393041905841223742229722846065374850524646486553697190990267605182875609969972107784730669801294274274395170323909647913676782217496309754197134381391626788785559991775284508827480465385881774472703067382348985029769028530013645504052272870939400583257885854573686549919562658630500834720876230660209033789194899209751908294216020103820394777720834006615191549726954365823050219109085766920481735349588941709767630848078374028138492275409420733154011152623348768159620874413022565584389125006072302057820130836741130234976124452147951709838486879883482032894412569087555652160818151512056388931125624153290844569340951461844692909011661106348755901648356069416294074897743797927398046747642434839120846918717692254465062843105653091908724772862559253835285450363605508542269195712463611332259048203019165883170843777122593678948464112948225870758354869856455108298805285787826984125562492745222350610924543423862023271204078275403339146131921891743158841366880194359662736634704314404430321364117756050306014368370639726903304174751873302009119675004967616181226147964529371240703987038908689155270514904657367453977649410948794796494381625766143469486520853080246963582567565857945684933190420538828438081803587871107744180754788011865195774162718963831698357082256365846545686437026186024335489381637207327725383454545130650115406757655106569705004135372053700679248802092173634073236733684480049044084139777417069654942470407997864518618221884735712575568194332840874860236762494678694836313804738564862395470156033183226127836520686997985394004066373116827311153406778416602407104315511403704103755855729393030840738435407021205519630505149599457413591699116765754784032793801120203473482925381507983204527948424275265017968529118631081782766384723202378700828622717633961951395137123031361943660215408305314569105840483725460251777651404602071129231519231764021467528682219668899153815964812531606968222607231942595218130543034572223679679292687630728923552788547142782438631107830670601244590393155281768403049315228131487458243508921305950151980025572043324832155514470975125100762233648012028880876356506546349468872327276239064590766702271086341623192103570072733693546571875690463948848950837941035318359596139945753778977755254619774647475181629750100914635619250327426455946458005816006983478170231943799213973476811504926872373490215642064630961387032012502777579804107726470143915791444243752525197667646704580085152976476241448144534960696851274398006295520756926486086815068790443764289774631751752051815479584595151590747012858384936940340076624101001835331415166841854607581750664815610189011330319510420990532971188374489844432308566427376064787878802852999035218550256124134710344666241715592090775384984751068112940290603342718033205664939350246217197176848044433518669466905252660607583321905318072325655018902937542595909474331403843353669733988168992536983021199161428916310053493353721580057799445291767358871939804092884746216945903030985523823769694423651860231309855078236176700511918890153514796597786761324496716420150595404382373039229030560790683446354402767725654259443299276549062629524755557509120238794246360214620433216314283656758518656549016934743434114062209075500900456895883239368146751261034644012237280581850483204752512668828752991205822530900331778836744323438127341239220429265549085482314732853495722109622898898009940265336293214647005520293915172930551962180656672512762374901292060984143389032109424889027922539246679410822732675635286538633434434864957624004099789959850520823107302770769652428462784025682851873655888766532454230472059434786129319642112934893741195657514867872048845023075123729239731191911256140687560945268927833216880303109005580256834554518984874011393152907434774619210259879053322362993988594489387420874873162887307110687527634493923668972362589970911769962532843066876354543618621794071916521552436506195717202321286241307854049305668050292332713755462533132874462858122199615650226545103738705816482147911391708709705090741587219676334254715505158014981911072162776206923470142349135273858121648344750020070994021229914395427839819849271813006696032901904951061957842485312997402627061067983385735239773652409412936952141886756327154470813722525510229819212511256751318392100741322860296214432621271458720224043142582192556064152802184450746540347901150755585133744227536171881983859311648101828170027941722798030282020865670812674533493413454963892393797764944190223010420679866005010454669500040571347269341476916780319866988453702999870673844073103374338281165148307453744907601716721529785950403514055725265230260512150937099005678735683852425745463850085677382639515326765492943564175657977715956384967191495778042162918921255410551471737237449917566696724590213751112887541253729183944179762430930282147033293860317993139495351613438927204090460650099589809789479976625455146641942620976652972426123679687660006291746558870908243635836538436589802775660312864296284763185729150458238958058260101327129778344186134682888329885473771745507968025731486842532941722850567778269273771580586471454035577212335120024954373394139988427825997101862157234379581542753405098110723490410464838062846088733942757188785904186928092883334235227812406989744418298793037942414558527767133213548706472510947206755723227884479087787788921162341316176084167322809874931413318849278602593243927812557861508918592034972126159164049990970677787399148579613058849346787620435155211905818982566246359578309278114211549921399869999362036311498523728025643148961517493264044287720082504285693383296981618501712654114267081137235583250590628715067128384609860311470603514915063160125325387933544995456670095275738108920480046524524521396887893929129382518883412981222352328611387339031535609672921042411909463505167697693050307623869083995925550431922360692794912244658266842033120812554318517563412345669139725893906015586508304374020455952076899961595975457118082036883181129189476616621158029195786364034303230416100180636967072212498263837152633888503074184694239734867470092339450362209015181857669427338368461268166381583450487827282412512798203101932235129591110298840022305716882168542822578732186317444509505523274289525381495452627798898243990285131322086386330706021355227520766615678724723251256742912688818491014163827036474514282328479933321571807940150363653616458881463557493661502090854571891872327863995858799416803703481411054047422984524978953692871939744961404456773012714035896658229110968329520211813435711369576078163183427557705604065699202616339664034841216798695426848436869083543736884379686835257236661214859479467478875727163608006964428164741135934661060892041795546771453745824379626646188830186286875100795112525560022417883462840197508639922839065135723259180534640806435215321548250748202390779907790070695880340296195621904167473597128840843245215986781788901864094514806867817331768249202768350024775234860935869637331554244918975754958515495270345383376943149530571640192150266707739109974432797600052906415115847071932263512716704397751410765526327361661176113949343256737438823655183185612089415529316291251367997115745789167410235872514289989469631824116505544042064163364874186561053330385457739601909496028500962085690852302287088948745775235125582819733929612639216561639633693884117634763886259524069015182734130370686433835502829622377291959017885993928766510865998492239942591452592404793843806578034980587190625290073394283162299977568998577121169227586830717074729355744992449784197881713384684717511253038609115892894008066372029204294899198702634159516608889754348273042974513623250526934820015248431712290784679105379131381154586266120249707308995151143019152816139292393293515010498592252745641078468181129383391613089431532051176517163804684622961938824442933704843685300968988127789731782849127985502452460634119184826382616940292452732916467073315946752134281587552738824383579602450640510158889185418011397716197432214050377972856694814558106533200089042159975979759073915120262140200120101347075367742276364775809181675078504851970653263910911714517637512376127394984685100090554800250960159855817693701796567811513065659525901019773983351850426376819823064484137221778956652903027962230041985260791431040700078745405482215823473895787419076942400727481338608233691306518076204361009674221579290719040619858762532542927481005014913765764511576139421431541604676635409021586558797152327419024652190612044660693995435376237453269257301351968475833102403001369008236966611120591489492515903721090781653063244581176729675960068856111942740131146840740541811184282840103004930033587050301900280487212275329820719538229025584586853416012880693465359149039189696272389562977393988534711551019333954374699288583646053249971063453730263564728856760186110311977064212243833134357208256222160645522427147562668961335127742514704508066065350492888477275980124150117639708989422759831098626780358600183566986993645900959533847966610129802053717740681727113599896621245073184945019268969821281470919288094309836935086280049529210899513358900892946097845649234235447752769274825864761270613428690709421136820281174870155241002571199674103957710112670611141230259423720618775007941625687469437425631850080526365777429066862274710511444737925672781712002353779026307058832211008928435045237483068464864135552613382236283996029971083220897986305897891731966709434578109722499468955961728119019245987541050221232627731661646957854925001791688432728730998876898269318290667599988068020564509132663190036411682160975457987265596336140953842411883537930043774357363620998602506078671956559415254590575394512979922359917893695680863804210613237189662157069244179283987801793513468553063862900533945505275994496303948455562249364447779953479766845703125e-4951
Hex (%a):     0x0.0000000000000002p-16382
int10 * ULP:  1 * 2**-16445
fpclassify:   FP_SUBNORMAL
Bits (hex):   0x00000000000000000001
Bits (bin):   0 000000000000000 0000000000000000000000000000000000000000000000000000000000000001
END



###############################################################################

finish

